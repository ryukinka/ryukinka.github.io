<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å››æŸ±æ¨å‘½ æ—¥ä¸»ãƒ»äº”è¡Œãƒã‚§ãƒƒã‚«ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN", "Meiryo", sans-serif;
      background: #f6f6f6;
      padding: 16px;
    }
    .card {
      max-width: 480px;
      width: 100%;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      padding: 20px 20px 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    h1 {
      font-size: 22px;
      margin-top: 0;
      margin-bottom: 12px;
      text-align: center;
    }
    label {
      font-size: 15px;
      display: block;
      margin-bottom: 6px;
    }
    input[type="date"] {
      padding: 10px 10px;
      font-size: 16px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 6px;
    }
    .smartphone-title {
      font-size: 14px;
      font-weight: bold;
      color: #333;
      margin-top: 8px;
      margin-bottom: 4px;
    }
    .hint {
      font-size: 13px;
      color: #555;
      margin-bottom: 14px;
      line-height: 1.7;
    }
    button {
      padding: 10px 18px;
      font-size: 15px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #4a90e2;
      color: #fff;
      display: block;
      margin: 0 auto 8px auto;
    }
    button:hover {
      opacity: 0.9;
    }
    .note {
      font-size: 11px;
      color: #666;
      text-align: center;
      margin-bottom: 10px;
    }
    .result {
      margin-top: 16px;
      font-size: 14px;
      line-height: 1.7;
      white-space: pre-line;
    }
    .highlight {
      font-weight: bold;
      font-size: 17px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>å››æŸ±æ¨å‘½ æ—¥ä¸»ãƒ»äº”è¡Œãƒã‚§ãƒƒã‚«ãƒ¼</h1>
    <p class="note">â€»1900ã€œ2099å¹´ãã‚‰ã„ã®è¥¿æš¦ã§ã®åˆ©ç”¨ã‚’æƒ³å®šã—ãŸç°¡æ˜“ãƒ„ãƒ¼ãƒ«ã§ã™</p>

    <label for="birthday">ç”Ÿå¹´æœˆæ—¥ã‚’é¸ã‚“ã§ãã ã•ã„</label>
    <input type="date" id="birthday">

    <p class="smartphone-title">ğŸ“± ã‚¹ãƒãƒ›ã®æ–¹ã¸</p>
    <p class="hint">
      â‘ ã€Œç”Ÿå¹´æœˆæ—¥ã€ã®ç©ºæ¬„ã‚’ã‚¿ãƒƒãƒ—ã—ã¾ã™<br>
      â‘¡ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ç”Ÿã¾ã‚ŒãŸæ—¥ã‚’é¸æŠã—ã¾ã™<br>
      â‘¢ é’æ–‡å­—ã®ã€Œè¥¿æš¦ã€ã¨ã€Œæœˆã€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€ç”Ÿã¾ã‚ŒãŸå¹´ã¨æœˆã‚’é¸æŠã—ã¾ã™
    </p>

    <button id="calcBtn">åˆ¤å®šã™ã‚‹</button>

    <div id="result" class="result"></div>
  </div>

  <script>
    function getRisshunDay(year) {
      const D = 0.2422;
      const Y = year % 100;
      const century = Math.floor(year / 100) + 1;
      let C;

      if (century === 20) C = 4.6295;
      else if (century === 21) C = 3.87;
      else if (century === 22) C = 4.15;
      else C = 3.87;

      const L = Math.floor((Y - 1) / 4);
      return Math.floor(Y * D + C) - L;
    }

    function isBeforeRisshun(year, month, day) {
      const risshunDay = getRisshunDay(year);
      return (month < 2) || (month === 2 && day < risshunDay);
    }

    function getFourPillarsYear(baseYear, month, day) {
      return isBeforeRisshun(baseYear, month, day) ? baseYear - 1 : baseYear;
    }

    const stems = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"];

    const stemToElement = {
      "ç”²": "æœ¨", "ä¹™": "æœ¨",
      "ä¸™": "ç«", "ä¸": "ç«",
      "æˆŠ": "åœŸ", "å·±": "åœŸ",
      "åºš": "é‡‘", "è¾›": "é‡‘",
      "å£¬": "æ°´", "ç™¸": "æ°´"
    };

    function toRdn(year, month, day) {
      let y = year;
      let m = month;
      if (m < 3) {
        y -= 1;
        m += 12;
      }
      return Math.floor(365.25 * y)
           + Math.floor(y / 400)
           - Math.floor(y / 100)
           + Math.floor(30.59 * (m - 2))
           + day
           - 678912;
    }

    const STEM_BASE_RDN = toRdn(1912, 2, 18);

    function getDayStem(year, month, day) {
      const rdn = toRdn(year, month, day);
      let idx = (rdn - STEM_BASE_RDN) % 10;
      if (idx < 0) idx += 10;
      return stems[idx];
    }

    function analyzeBirthday(year, month, day) {
      const fourPillarsYear = getFourPillarsYear(year, month, day);
      const risshunDay      = getRisshunDay(year);
      const dayStem         = getDayStem(year, month, day);
      const element         = stemToElement[dayStem];

      return { fourPillarsYear, risshunDay, dayStem, element };
    }

    function onClickCalc() {
      const input = document.getElementById("birthday").value;
      const resultEl = document.getElementById("result");

      if (!input) {
        alert("ç”Ÿå¹´æœˆæ—¥ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
        return;
      }

      const [y, m, d] = input.split("-").map(Number);
      const info = analyzeBirthday(y, m, d);

      let text = "";
      text += `å…¥åŠ›ã•ã‚ŒãŸç”Ÿå¹´æœˆæ—¥ï¼š${y}å¹´${m}æœˆ${d}æ—¥\n`;
      text += `ãã®å¹´ã®ç«‹æ˜¥ï¼š${y}å¹´2æœˆ${info.risshunDay}æ—¥ã”ã‚\n`;
      text += `å››æŸ±ä¸Šã®å¹´ï¼ˆç«‹æ˜¥åŸºæº–ï¼‰ï¼š${info.fourPillarsYear}å¹´\n\n`;
      text += `æ—¥ä¸»ï¼š${info.dayStem}\n`;
      text += `ã‚ãªãŸã®æ—¥ä¸»ã®äº”è¡Œã¯ã€Œ${info.element}ã€ã§ã™ã€‚`;

      resultEl.innerHTML =
        `<div class="highlight">æ—¥ä¸»ã®äº”è¡Œï¼š${info.element}</div>` +
        text.replace(/\n/g, "<br>");
    }

    document.getElementById("calcBtn").addEventListener("click", onClickCalc);
  </script>
</body>
</html>
